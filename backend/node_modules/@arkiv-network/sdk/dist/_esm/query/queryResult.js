import { NoCursorOrLimitError, NoMoreResultsError } from "./errors";
export class QueryResult {
    entities;
    _endOfIteration;
    _cursor;
    _limit;
    _validAtBlock;
    _queryBuilder;
    // Public getters for internal state
    get queryBuilder() {
        return this._queryBuilder;
    }
    get cursor() {
        return this._cursor;
    }
    constructor(entities, queryBuilder, cursor, limit, validAtBlock) {
        this.entities = entities;
        this._queryBuilder = queryBuilder;
        this._endOfIteration = !limit || entities.length < limit;
        this._cursor = cursor;
        this._limit = limit;
        this._validAtBlock = validAtBlock;
    }
    async next() {
        if (this._cursor === undefined || this._limit === undefined) {
            throw new NoCursorOrLimitError();
        }
        if (this._endOfIteration) {
            throw new NoMoreResultsError();
        }
        this._queryBuilder.cursor(this._cursor);
        const result = await this._queryBuilder.fetch();
        this.entities = result.entities;
        // Update the query builder reference
        this._queryBuilder = result.queryBuilder;
        // Check if we've reached the end (no more cursor or we got fewer entities than limit)
        this._endOfIteration = !result.cursor || result.entities.length < this._limit;
        // Update the cursor
        this._cursor = result.cursor;
        // TODO check current block height and if it is not too old
        console.debug("Current block height for next page: ", this._validAtBlock);
    }
    hasNextPage() {
        return !this._endOfIteration;
    }
}
//# sourceMappingURL=queryResult.js.map